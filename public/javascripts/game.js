function e(e){createjs.Tween.get(h,{loop:!0}).to({x:-a},45*x),createjs.Tween.get(d,{loop:!0}).to({x:a},5e3*x),createjs.Tween.get(l,{loop:!0}).to({x:-a},500*x),createjs.Tween.get(g,{loop:!0}).to({x:-a},80*x)}function t(e){B||(y.volume=0==y.volume?T:0,$(document).trigger("play-pause"),B=!0);var t=e.delta/5;if(!e.paused){v.forEach(function(e,n){treeBounds=e.getBounds(),e.x=e.x+treeBounds.width<=0?e.x=a+treeBounds.width+Math.random()*a:e.x-t}),S.forEach(function(e,n){buildingBounds=e.getBounds(),e.x=e.x+buildingBounds.width<=0?a+buildingBounds.width+Math.random()*a:e.x-t}),w.x+200<0?(w.x=a+(.5+Math.random())*a,C.ditch=!1):w.x=w.x-t;var o=w.localToLocal(0,0,m);if(hitDitch(m.hitTest(o.x,o.y)),Math.random()>.95){var r=Math.random()<.6;dropTokens(r)}if(k.forEach(function(e){var t=e.localToLocal(20,0,m);m.hitTest(t.x,t.y)&&tokenCollected(e,!0)},this),b.forEach(function(e){var t=e.localToLocal(20,0,m);m.hitTest(t.x,t.y)&&tokenCollected(e,!1)},this),"right"==m.move){var s=m.getBounds();m.x=m.x+s.width<a?m.x+7:m.x}else"left"==m.move&&(m.x=m.x>0?m.x-7:m.x);n(e.runTime),createjs.Ticker.getTime(!0)/6e4>=2&&($(document).trigger("play-pause"),$(document).trigger("game-over",["time-out"])),i.update(e)}}function n(e){p.text=new Date(e).toISOString().substr(11,8)}function o(e){if(-1!==location.pathname.search("/play-game")){var t=e.type;39!==e.keyCode&&37!==e.keyCode&&32!==e.keyCode||(39===e.keyCode&&(m.move="keydown"==t?"right":null),37===e.keyCode&&(m.move="keydown"==t?"left":null),32===e.keyCode&&($("#questions-modal").hasClass("open")||"keydown"!=t||$(document).trigger("play-pause")))}}!function(e){"use strict";function t(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function n(e,t){return e<<t|e>>>32-t}function o(e,o,i,a,r,s){return t(n(t(t(o,e),t(a,s)),r),i)}function i(e,t,n,i,a,r,s){return o(t&n|~t&i,e,t,a,r,s)}function a(e,t,n,i,a,r,s){return o(t&i|n&~i,e,t,a,r,s)}function r(e,t,n,i,a,r,s){return o(t^n^i,e,t,a,r,s)}function s(e,t,n,i,a,r,s){return o(n^(t|~i),e,t,a,r,s)}function u(e,n){e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;var o,u,c,d,h,l=1732584193,g=-271733879,m=-1732584194,p=271733878;for(o=0;o<e.length;o+=16)u=l,c=g,d=m,h=p,l=i(l,g,m,p,e[o],7,-680876936),p=i(p,l,g,m,e[o+1],12,-389564586),m=i(m,p,l,g,e[o+2],17,606105819),g=i(g,m,p,l,e[o+3],22,-1044525330),l=i(l,g,m,p,e[o+4],7,-176418897),p=i(p,l,g,m,e[o+5],12,1200080426),m=i(m,p,l,g,e[o+6],17,-1473231341),g=i(g,m,p,l,e[o+7],22,-45705983),l=i(l,g,m,p,e[o+8],7,1770035416),p=i(p,l,g,m,e[o+9],12,-1958414417),m=i(m,p,l,g,e[o+10],17,-42063),g=i(g,m,p,l,e[o+11],22,-1990404162),l=i(l,g,m,p,e[o+12],7,1804603682),p=i(p,l,g,m,e[o+13],12,-40341101),m=i(m,p,l,g,e[o+14],17,-1502002290),g=i(g,m,p,l,e[o+15],22,1236535329),l=a(l,g,m,p,e[o+1],5,-165796510),p=a(p,l,g,m,e[o+6],9,-1069501632),m=a(m,p,l,g,e[o+11],14,643717713),g=a(g,m,p,l,e[o],20,-373897302),l=a(l,g,m,p,e[o+5],5,-701558691),p=a(p,l,g,m,e[o+10],9,38016083),m=a(m,p,l,g,e[o+15],14,-660478335),g=a(g,m,p,l,e[o+4],20,-405537848),l=a(l,g,m,p,e[o+9],5,568446438),p=a(p,l,g,m,e[o+14],9,-1019803690),m=a(m,p,l,g,e[o+3],14,-187363961),g=a(g,m,p,l,e[o+8],20,1163531501),l=a(l,g,m,p,e[o+13],5,-1444681467),p=a(p,l,g,m,e[o+2],9,-51403784),m=a(m,p,l,g,e[o+7],14,1735328473),g=a(g,m,p,l,e[o+12],20,-1926607734),l=r(l,g,m,p,e[o+5],4,-378558),p=r(p,l,g,m,e[o+8],11,-2022574463),m=r(m,p,l,g,e[o+11],16,1839030562),g=r(g,m,p,l,e[o+14],23,-35309556),l=r(l,g,m,p,e[o+1],4,-1530992060),p=r(p,l,g,m,e[o+4],11,1272893353),m=r(m,p,l,g,e[o+7],16,-155497632),g=r(g,m,p,l,e[o+10],23,-1094730640),l=r(l,g,m,p,e[o+13],4,681279174),p=r(p,l,g,m,e[o],11,-358537222),m=r(m,p,l,g,e[o+3],16,-722521979),g=r(g,m,p,l,e[o+6],23,76029189),l=r(l,g,m,p,e[o+9],4,-640364487),p=r(p,l,g,m,e[o+12],11,-421815835),m=r(m,p,l,g,e[o+15],16,530742520),g=r(g,m,p,l,e[o+2],23,-995338651),l=s(l,g,m,p,e[o],6,-198630844),p=s(p,l,g,m,e[o+7],10,1126891415),m=s(m,p,l,g,e[o+14],15,-1416354905),g=s(g,m,p,l,e[o+5],21,-57434055),l=s(l,g,m,p,e[o+12],6,1700485571),p=s(p,l,g,m,e[o+3],10,-1894986606),m=s(m,p,l,g,e[o+10],15,-1051523),g=s(g,m,p,l,e[o+1],21,-2054922799),l=s(l,g,m,p,e[o+8],6,1873313359),p=s(p,l,g,m,e[o+15],10,-30611744),m=s(m,p,l,g,e[o+6],15,-1560198380),g=s(g,m,p,l,e[o+13],21,1309151649),l=s(l,g,m,p,e[o+4],6,-145523070),p=s(p,l,g,m,e[o+11],10,-1120210379),m=s(m,p,l,g,e[o+2],15,718787259),g=s(g,m,p,l,e[o+9],21,-343485551),l=t(l,u),g=t(g,c),m=t(m,d),p=t(p,h);return[l,g,m,p]}function c(e){var t,n="",o=32*e.length;for(t=0;t<o;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function d(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var o=8*e.length;for(t=0;t<o;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function h(e){return c(u(d(e),8*e.length))}function l(e,t){var n,o,i=d(e),a=[],r=[];for(a[15]=r[15]=void 0,i.length>16&&(i=u(i,8*e.length)),n=0;n<16;n+=1)a[n]=909522486^i[n],r[n]=1549556828^i[n];return o=u(a.concat(d(t)),512+8*t.length),c(u(r.concat(o),640))}function g(e){var t,n,o="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=o.charAt(t>>>4&15)+o.charAt(15&t);return i}function m(e){return unescape(encodeURIComponent(e))}function p(e){return h(m(e))}function f(e){return g(p(e))}function v(e,t){return l(m(e),m(t))}function w(e,t){return g(v(e,t))}function $(e,t,n){return t?n?v(t,e):w(t,e):n?p(e):f(e)}"function"==typeof define&&define.amd?define(function(){return $}):"object"==typeof module&&module.exports?module.exports=$:e.sign=$}(this);var i,a,r,s,u,c,d,h,l,g,m,p,f,v,w,S,k,b,y,j,x=100,C={},T=.5,q={value:0,ob:{}},R={value:0,ob:{}},B=!1,_=0;!function(){var e=q.value,t=Math.floor((new Date).getUTCMinutes()/5);j=sign(e+t)}();var A=[{src:"Sky.png",id:"sky"},{src:"Sun.png",id:"sun"},{src:"Buildings-Back.png",id:"backBg"},{src:"Buildings-Front.png",id:"frontBg"},{src:"Road.png",id:"road"},{src:"Clouds.png",id:"clouds"},{src:"tree-sprite.png",id:"tree"},{src:"building-sprite.png",id:"building"},{src:"ambulance-sprite.png",id:"amb"},{src:"star-sprite.png",id:"star"},{src:"ditch.png",id:"ditch"},{src:"positive-sprite.png",id:"ptoken"},{src:"negative-sprites.png",id:"ntoken"}];$(document).on("initialize-game",function(){i=new createjs.Stage("game-holder"),a=i.canvas.width,r=i.canvas.height,(s=new createjs.LoadQueue(!1)).addEventListener("complete",function(n){$(".preloader").removeClass("loading"),$(".preloader .preloader-wrapper").removeClass("active"),(u=new createjs.Shape).graphics.beginBitmapFill(s.getResult("sky")).drawRect(0,0,a,r);var o=s.getResult("sun");(c=new createjs.Shape).graphics.beginBitmapFill(o).drawRect(o.width,0,o.width,o.height),c.y=.2*o.height,c.x=Math.random()*(a-2*o.width);var y=s.getResult("clouds");(d=new createjs.Shape).graphics.beginBitmapFill(y).drawRect(0,0,5*y.width,y.height),d.x=-4*y.width,d.cache(0,0,5*y.width,y.height);var j=s.getResult("road");(h=new createjs.Shape).graphics.beginBitmapFill(j).drawRect(0,0,2*j.width,j.height),h.tileW=0,h.y=r-j.height,h.cache(0,0,2*j.width,j.height);var x=s.getResult("backBg");(l=new createjs.Shape).graphics.beginBitmapFill(x).drawRect(0,0,2*x.width,x.height),l.y=r-(x.height+j.height),l.cache(0,0,2*x.width,x.height);var C=s.getResult("frontBg");(g=new createjs.Shape).graphics.beginBitmapFill(C).drawRect(0,0,2*C.width,C.height),g.y=r-(C.height+j.height),g.cache(0,0,2*C.width,C.height);var T=s.getResult("ditch");(w=new createjs.Shape).graphics.beginBitmapFill(T).drawRect(0,0,T.width,T.height),w.x=(.5+Math.random())*a,w.y=r-.75*j.height,w.cache(0,0,T.width,T.height);var B={id:"building",width:274,height:126,number:3};S=[];for(var _=new createjs.SpriteSheet({images:[s.getResult(B.id)],frames:{width:B.width,height:B.height}}),A=0;A<=B.number;A++){var M=new createjs.Sprite(_),E=_.getFrameBounds(A);M.gotoAndStop(A),M.setTransform(Math.random()*a,r-(j.height+E.height)+2),S.push(M)}var F=new createjs.SpriteSheet({images:[s.getResult("tree")],frames:{width:100,height:150}});f=function(){for(var e=[],t=0;t<4;t++){var n=new createjs.Sprite(F),o=F.getFrameBounds(t);n.gotoAndStop(t),n.setTransform(Math.random()*a,r-(j.height+o.height)+2),e.push(n)}return e};N=new createjs.SpriteSheet({framerate:3,images:[s.getResult("amb")],frames:{regX:0,height:150,count:15,regY:0,width:150},animations:{run:[0,4,"run",1.5],hickup:[5,6,"run"],plus:[7,10,"run",6],minus:[11,14,"run",6]}});(m=new createjs.Sprite(N,"run")).x=.1*a,m.y=r-3*j.height,m.setBounds(0,0,150,150);var P=new createjs.SpriteSheet({images:[s.getResult("ptoken")],frames:{width:47,height:47}}),O=new createjs.SpriteSheet({images:[s.getResult("ntoken")],frames:{width:47,height:47}});createTokens=function(){for(k=[],t=1;t<=4;t++){var e=new createjs.Sprite(P);e.gotoAndStop(t),k.push(e)}b=[];for(var t=1;t<=2;t++){var n=new createjs.Sprite(O);n.gotoAndStop(t),b.push(n)}},q.ob=new createjs.Text("POINTS:"+q.value,"30px monospace","#00000"),q.ob.x=10,q.ob.y=10,(p=new createjs.Text("00:00:00","30px monospace","#00000")).x=a-150,p.y=10;var N=new createjs.SpriteSheet({images:[s.getResult("star")],frames:{height:27,width:112}});R.ob=new createjs.Sprite(N),R.ob.numFrames=N.getNumFrames(),R.ob.x=10,R.ob.y=50,i.addChild(u,c,d,l,g,h,w,q.ob,R.ob,p),(v=f()).forEach(function(e){i.addChild(e)}),S.forEach(function(e){i.addChild(e)}),createTokens(),i.addChild(m),createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.interval=100,createjs.Ticker.on("tick",t),e()}),s.loadManifest(A,!0,"../images/"),[{path:"../audio/bg-music.mp3",key:"music",type:"mp3",main:!0},{path:"../audio/got-item.mp3",key:"plusSound",type:"mp3"},{path:"../audio/lost-item.mp3",key:"minusSound",type:"mp3"}].forEach(function(e){createjs.Sound.alternateExtensions=[e.type],e.main&&createjs.Sound.on("fileload",function(){y=createjs.Sound.play(e.key,{interrupt:createjs.Sound.INTERRUPT_NONE,loop:-1,volume:0})},this),createjs.Sound.registerSound(e.path,e.key)},this)}),dropTokens=function(e){var t=e?k:b,n=t[Math.floor(Math.random()*t.length-1)+1];n.isAnimating||(n.isAnimating=!0,n.notCollectd=!0,n.x=Math.floor(Math.random()*a)+1,n.y=-200,i.addChild(n),createjs.Tween.get(n).to({y:a},45*x).call(function(){n.isAnimating=!1,i.removeChild(n)}))},tokenCollected=function(e,t){if(i.removeChild(e),e.notCollectd){e.notCollectd=!1,q.value=t?q.value+10:q.value-10,q.ob.text="SCORE:"+q.value,j=sign(q.value+Math.floor((new Date).getUTCMinutes()/5));var n=.25*y.volume;t?(_<3&&(_++,$(document).trigger("hint-indicator-change",[_-1])),3===_&&$(document).trigger("showhint"),createjs.Sound.play("plusSound",{volume:n}),m.gotoAndPlay("plus"),$(document).trigger("token-caught",[!0])):(createjs.Sound.play("minusSound",{volume:n}),m.gotoAndPlay("minus"),$(document).trigger("token-caught",[!1]))}},hitDitch=function(e){!C.ditch&&e&&(C.ditch=!0,m.gotoAndPlay("hickup"),$(document).trigger("hit-ditch"))},$(window).on("keydown",o),$(window).on("keyup",o),$("#mute-btn").on("click",function(){createjs.Ticker.getPaused()||$(this).toggleClass("btn-clicked"),$(document).trigger("toggle-mute")}),$("#start-btn").on("click",function(){$(document).trigger("play-pause")}),$(document).on("hit-ditch",function(){$(document).trigger("play-pause"),$(document).trigger("showquestion")}),$(document).on("play-pause",function(){createjs.Ticker.setPaused(!createjs.Ticker.getPaused()),$("#start-btn").toggle(),$(document).trigger("toggle-mute")}),$(document).on("update-star",function(){R.ob.gotoAndStop(++R.ob.currentFrame%R.ob.numFrames)}),$(document).on("toggle-mute",function(){var e=$("#mute-btn");0!=y.volume||e.hasClass("btn-clicked")||createjs.Ticker.getPaused()?($("#mute-btn").addClass("active"),y.volume=0):(e.removeClass("active"),y.volume=T)}),$(document).on("plusSound",function(){createjs.Sound.play("plusSound",{volume:.25*T})}),$(document).on("minusSound",function(){createjs.Sound.play("minusSound",{volume:.25*T})});var M=!1,E=0,F=0,P=0,O=0,N=0,D=!1;$(".modal").modal({dismissible:!1});var I=function(e){$(e).removeClass("invalid"),$(e).find("input").prop("checked",!1).removeAttr("disabled")};$(document).on("showhint",function(){if(!M){var e=$(".question").eq(E).find(".hint").text();""!==e&&(e='<b class="green-text">Hint: </b>'+e,Materialize.toast(e,4e7),M=!0)}}),$(document).on("showquestion",function(){$(".question").addClass("hide"),$(".question").eq(E).removeClass("hide"),$("#questions-modal").modal("open"),$("#questions-modal").css({display:"block"})}),$("#questionClose").on("click",function(){$(".toast").fadeOut(600,function(){$(".toast").remove()}),$(document).trigger("hint-indicator-change",["RESET"]),$(".question").eq(E).hasClass("valid")?(setTimeout(function(){$(document).trigger("update-star"),$(document).trigger("update-star"),5===F&&($(document).trigger("play-pause"),$(document).trigger("show-loader"),D&&(location.href="/game-over/"+location.pathname.split("/").pop()))},600),$(".question").eq(E).remove()):(I($(".question").eq(E)),$(".question").length===E?E=0:E++),_=0,$("#questions-modal").modal("close"),$("#questionClose").attr("disabled",!0),M=!1,$(document).trigger("play-pause")}),$(".question input").on("click",function(){$("#questionSubmit").removeAttr("disabled")}),$("#questionSubmit").on("click",function(){var e=$(".question").eq(E),t=$(e).find("input:checked").val(),n=$(e).attr("id");$("#questionSubmit").attr("disabled",!0),$(e).find("input").attr("disabled",!0);var o=["a","b","c","d"];$.ajax({method:"POST",url:"/check-answer/"+$("#mute-btn").data("id")+"/"+n,data:{answeredAs:t,Negative_Tokens_Caught__c:N,Positive_Tokens_Caught__c:O,Time_Taken__c:parseInt((createjs.Ticker.getTime(!0)/1e3).toFixed(0),10),Sign__c:j},cache:!1,success:function(t){P++,N=0,O=0,t.answeredCorrect?($(e).addClass("valid"),F++,$(document).trigger("plusSound")):($(e).addClass("invalid"),$(document).trigger("minusSound"),$(e).find("p").eq(o.indexOf(t.correctOption)).addClass("correct-answer")),$("#questionClose").removeAttr("disabled"),t.endGame&&(D=!0)},error:function(e){Materialize.toast("Your Session has timedout. You will be redirected now",5e3,"",function(){window.location="/"})}})}),$(document).on("token-caught",function(e,t){t?O++:N++}),$(document).on("hint-indicator-change",function(e,t){var n=$(".hit-progress .messages"),o=$(".hit-progress .progress-show .determinate");"RESET"===t?($(n).removeAttr("style"),$(o).removeAttr("style")):($(n).css("margin-top","-"+20*(t+1)+"px"),$(o).eq(t).css("width","99.99%"))}),$(document).on("game-over",function(e,t){"time-out"===t&&$.ajax({url:"/saveAttempt/"+$("#mute-btn").data("id"),method:"POST",cache:!1,data:{Negative_Tokens_Caught__c:N,Positive_Tokens_Caught__c:O,Sign__c:j},success:function(e){location.href="/game-over/"+location.pathname.split("/").pop()},error:function(e){Materialize.toast("Your Session has timedout. You will be redirected now",5e3,"",function(){window.location="/"})}})});